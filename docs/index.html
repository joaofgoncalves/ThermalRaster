<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="The package is designed to enhance the processing and
    analysis of FLIR thermal and RGB images. It offers a comprehensive
    suite of functions for extracting, processing, and visualizing thermal
    data embedded within the metadata of FLIR images. Key features also
    include retrieving full and cropped RGB images. Imagery is returned as
    SpatRaster objects compatible with the terra package, enabling to
    profit from this package features/toolkit. Using RGB images, it is
    possible to generate synthetic/predicted thermal images for the
    cropped or full RGB images via Deep Learning or Random Forests
    algorithms. The package also enables the handling of JSON
    annotations/masks from Roboflow (https://roboflow.com), enabling the
    extraction of ROIs from the images for further analysis, making
    possible assess, analyze and model fine-scale thermal variation in
    micro-habitats (i.e., TReMs - Tree Related Micro-habitats). Roboflows
    advantages include improved ROI digitization using manual or the SAM
    (Facebooks Segment Anything) algorithm. ROI's can also be generated
    with the terra package as SpatVector objects. EXIFtool
    (https://exiftool.org/) is broadly used for retrieving metadata from
    FLIR imagery and the ThermImage package to convert from raw to 
    temperature.">
<title>Extract, process and visualize thermal and RGB images from FLIR
    cameras • ThermalRaster</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/Roboto-0.4.8/font.css" rel="stylesheet">
<!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Extract, process and visualize thermal and RGB images from FLIR
    cameras">
<meta property="og:description" content="The package is designed to enhance the processing and
    analysis of FLIR thermal and RGB images. It offers a comprehensive
    suite of functions for extracting, processing, and visualizing thermal
    data embedded within the metadata of FLIR images. Key features also
    include retrieving full and cropped RGB images. Imagery is returned as
    SpatRaster objects compatible with the terra package, enabling to
    profit from this package features/toolkit. Using RGB images, it is
    possible to generate synthetic/predicted thermal images for the
    cropped or full RGB images via Deep Learning or Random Forests
    algorithms. The package also enables the handling of JSON
    annotations/masks from Roboflow (https://roboflow.com), enabling the
    extraction of ROIs from the images for further analysis, making
    possible assess, analyze and model fine-scale thermal variation in
    micro-habitats (i.e., TReMs - Tree Related Micro-habitats). Roboflows
    advantages include improved ROI digitization using manual or the SAM
    (Facebooks Segment Anything) algorithm. ROI's can also be generated
    with the terra package as SpatVector objects. EXIFtool
    (https://exiftool.org/) is broadly used for retrieving metadata from
    FLIR imagery and the ThermImage package to convert from raw to 
    temperature.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="index.html">ThermalRaster</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="reference/index.html">Reference</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="readme">README<a class="anchor" aria-label="anchor" href="#readme"></a>
</h1></div>
<p>João Gonçalves 2024-04-02</p>
</div>
<div class="section level1">
<h1 id="thermalraster">ThermalRaster<a class="anchor" aria-label="anchor" href="#thermalraster"></a>
</h1>
<p><img src="reference/figures/ThermalRaster_logo.png"></p>
<div class="section level2">
<h2 id="table-of-contents">Table of Contents<a class="anchor" aria-label="anchor" href="#table-of-contents"></a>
</h2>
<ul>
<li>
<a href="#thermalraster">ThermalRaster</a>
<ul>
<li><a href="#package-description">Package description</a></li>
<li><a href="#working-with-rgb-imagery">Working with RGB imagery</a></li>
<li><a href="#working-with-thermal-data">Working with thermal data</a></li>
<li><a href="#generating-synthetic-or-predicted-thermal-images">Generating synthetic or predicted thermal images</a></li>
<li>
<a href="#working-with-regions-of-interest-rois">Working with regions-of-interest ROIs</a>
<ul>
<li><a href="#drawing-rois-with-the-terra-package">Drawing ROIs with the terra package</a></li>
<li><a href="#drawing-rois-with-the-roboflow">Drawing ROIs with the Roboflow</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="package-description">Package description<a class="anchor" aria-label="anchor" href="#package-description"></a>
</h2>
<p><strong>ThermalRaster</strong> package is designed to enhance the processing and analysis of FLIR thermal and RGB images. It offers a comprehensive suite of functions for extracting, processing, and visualizing <strong>thermal data</strong> embedded within the metadata of FLIR images. Key features also include retrieving full and cropped <strong>RGB images</strong>. Imagery is returned as <strong><code>SpatRaster</code></strong> objects compatible with the <strong><code>terra</code></strong> package, enabling to profit from this package features/toolkit.</p>
<p>Using the overlap between low-resolution thermal imagery with high-resolution RGB images, the package enables the creation of synthetic or predicted thermal images for either cropped or full RGB images. This is achieved through the application of the Random Forest algorithm (via the <strong><code>ranger</code></strong> package) or Deep Learning methodologies (utilizing <strong><code>keras</code></strong>/<strong><code>tensorflow</code></strong>).</p>
<p>The package also enables the handling of JSON annotations/masks from Roboflow (<a href="https://roboflow.com" class="external-link uri">https://roboflow.com</a>), enabling the extraction of ROIs from the images for further analysis, making possible to assess, plot, analyze and model fine-scale thermal variation in micro-habitats (i.e., TReMs - Tree Related Micro-habitats). Roboflow’s advantages include improved ROI digitization using manual or the SAM (Facebook’s Segment Anything) algorithm. ROIs can also be generated with the terra package as <strong><code>SpatVector</code></strong> objects.</p>
<p>EXIFtool (<a href="https://roboflow.com" class="external-link">https://exiftool.org/</a>) is broadly used for retrieving metadata from FLIR imagery and the <strong><code>ThermImage</code></strong> package to convert from raw to temperature.</p>
<hr>
<p>Here we will show some examples of processing FLIR ONE Edge Pro imagery that are provided as samples in the package:</p>
</div>
<div class="section level2">
<h2 id="working-with-rgb-imagery">Working with RGB imagery<a class="anchor" aria-label="anchor" href="#working-with-rgb-imagery"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ThermalRaster</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Image path in sample data</span></span>
<span><span class="va">image_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"BEECH1_EINBRGB_IPUQ4327.JPG"</span>, package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Provide here the folder path where the EXIFtool executale is</span></span>
<span><span class="co"># NOTE: The executable must be named exiftool</span></span>
<span><span class="va">exiftool_path</span> <span class="op">=</span> <span class="st">"C:/MyFiles/R-dev/Giant_Trees"</span></span></code></pre></div>
<p>Plot the FLIR image thumbnail as it is captured by the FLIR camera:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thumb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_thumbnail_to_rast.html">flir_thumbnail_to_rast</a></span><span class="op">(</span><span class="va">image_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">thumb</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-thumnail-img-1.png"><!-- --></p>
<p>Now let’s check the full RGB image that is contained in FLIR’s metadata:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgb_hr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_rgb_to_rast.html">flir_rgb_to_rast</a></span><span class="op">(</span><span class="va">image_path</span>, <span class="va">exiftool_path</span>, crop <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rgb_hr</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="do">## class       : SpatRaster </span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="do">## dimensions  : 1440, 1080, 3  (nrow, ncol, nlyr)</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="do">## resolution  : 1, 1  (x, y)</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="do">## extent      : 0, 1080, 0, 1440  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="do">## coord. ref. :  </span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="do">## source(s)   : memory</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="do">## names       : red, green, blue </span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a><span class="do">## min values  :   0,     0,    0 </span></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="do">## max values  : 255,   255,  255</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_hr</span>, main <span class="op">=</span> <span class="st">"Full RGB (1440x1080"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-full-rgb-1.png"><!-- --></p>
<p>And now the cropped RGB which matches the size and resolution of thermal image (i.e., 640x480):</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rgb_lr</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_rgb_to_rast.html">flir_rgb_to_rast</a></span><span class="op">(</span><span class="va">image_path</span>, <span class="va">exiftool_path</span>, crop <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_lr</span>, main <span class="op">=</span> <span class="st">"Cropped RGB (640x480)"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-crop-rgb-1.png"><!-- --></p>
<p>We can see that the second image is narrower and closer to the tree trunk (focus target).</p>
</div>
<div class="section level2">
<h2 id="working-with-thermal-data">Working with thermal data<a class="anchor" aria-label="anchor" href="#working-with-thermal-data"></a>
</h2>
<p>Start by extracting the thermal data (in degrees Celsius):</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_raw_to_thermal.html">flir_raw_to_thermal</a></span><span class="op">(</span><span class="va">image_path</span>, <span class="va">exiftool_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="do">## class       : SpatRaster </span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="do">## dimensions  : 640, 480, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="do">## resolution  : 1, 1  (x, y)</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="do">## extent      : 0, 480, 0, 640  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="do">## coord. ref. :  </span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="do">## source(s)   : memory</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="do">## name        :     lyr.1 </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="do">## min value   : -30.02469 </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="do">## max value   :  42.08388</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="do">## Warning: [summary] used a sample</span></span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="do">##      lyr.1       </span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="do">##  Min.   :-30.02  </span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="do">##  1st Qu.: 12.16  </span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="do">##  Median : 14.87  </span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="do">##  Mean   : 15.00  </span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="do">##  3rd Qu.: 18.33  </span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a><span class="do">##  Max.   : 42.08</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">temp</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main <span class="op">=</span> <span class="st">"Thermal cropped"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_lr</span>, main <span class="op">=</span> <span class="st">"RGB cropped"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/raw-to-thermal-print-1.png"><!-- --></p>
<p>Now let’s remove outliers in the thermal image that seem to more frequently occur for the lower portion of the temperature distribution values and plot again.</p>
<p>We will convert values lower than the 3.5% percentile to <code>NA</code> and keep all the remaining values of the upper part of the distribution unchanged.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp_out_rm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/remove_outliers.html">remove_outliers</a></span><span class="op">(</span><span class="va">temp</span>, pmin <span class="op">=</span> <span class="fl">3.5</span>, pmax <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">temp_out_rm</span>, palette <span class="op">=</span> <span class="st">"magma"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/thermal-rm-outliers-plot-1.png"><!-- --></p>
<p>By removing outliers temperature gradients in the tree surface and micro-habitats such as cavities are highlighted.</p>
<p>Let’s test different color palette to plot the image:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">temp_out_rm</span>, palette<span class="op">=</span><span class="st">"Spectral"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-spectral-palette-1.png"><!-- --></p>
</div>
<div class="section level2">
<h2 id="generating-synthetic-or-predicted-thermal-images">Generating synthetic or predicted thermal images<a class="anchor" aria-label="anchor" href="#generating-synthetic-or-predicted-thermal-images"></a>
</h2>
<p>The <code>ThermalRaster</code> package currently provides methods to generate <strong>synthetic or predicted thermal data</strong>. This enables to gain more detail into the fine-scale variation of surface temperature for inspecting/visualizing structures and micro-habitats.</p>
<p>To achieve this, we use the overlap between the “low-resolution” thermal imagery — i.e., as the target or response variable — with the “high-resolution” RGB cropped image — i.e., predictors or features, based on color and texture — to train a Random Forest or Deep Learning model.</p>
<p>Because generalization across images is highly “challenging”, to implement these methods we need to train the model every time. This also means different levels of performance or success depending on the objects depicted in the images.</p>
<p>After training, the model it can be applied onto the images used for training — i.e., the “low-resolution” or cropped RGB images — and also the full RGB image both extracted from the FLIR’s metadata.</p>
<p>Keep in mind that synthetic/predicted thermal data for the full RGB has limitations since the train region may not include features in this image.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_sup_res</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/rf_thermal_from_rgb.html">rf_thermal_from_rgb</a></span><span class="op">(</span></span>
<span>             rgb_rst <span class="op">=</span> <span class="va">rgb_lr</span>,      <span class="co"># The predictors from cropped/low-res RGB</span></span>
<span>             temp_rst <span class="op">=</span> <span class="va">temp</span>,       <span class="co"># The target thermal image</span></span>
<span>             rgb_high_res <span class="op">=</span> <span class="va">rgb_hr</span>, <span class="co"># The full RGB image</span></span>
<span>             npix <span class="op">=</span> <span class="fl">30000</span>,          <span class="co"># Number of sample pixels used for training</span></span>
<span>             rm_cor <span class="op">=</span> <span class="cn">FALSE</span>,        <span class="co"># Remove predictors through correlation</span></span>
<span>             rm_cor_thresh <span class="op">=</span> <span class="fl">0.98</span>,  <span class="co"># Correlation threshold; used if rm_cor = TRUE</span></span>
<span>             get_rf_model <span class="op">=</span> <span class="cn">TRUE</span>,   <span class="co"># Get the RF model in the output object</span></span>
<span>             verbose <span class="op">=</span> <span class="cn">TRUE</span>,        <span class="co"># Print progress messages?</span></span>
<span>             scale_data <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>    <span class="co"># Scale the data before model training?</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="do">## |-&gt; Calculating features ...</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a><span class="do">## Done.</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a><span class="do">## |-&gt; Extracting sample data for training ...</span></span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a><span class="do">## Done.</span></span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="do">## |-&gt; Training Random Forest model ...</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="do">## Done.</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a><span class="do">## |-&gt; Super-resolving the thermal image ...</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a><span class="do">## |-&gt; Calculating features for the high-resolution RGB image ...</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a><span class="do">## Done.</span></span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="do">## Predicting.. Progress: 75%. Estimated remaining time: 10 seconds.</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a><span class="do">## Done.</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a><span class="do">## [Run Time: 2 minutes 37 seconds ]</span></span></code></pre></div>
<p>Let’s check the RF model output:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">rf_sup_res</span><span class="op">$</span><span class="va">rf_mod</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="do">## Ranger result</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="do">## Call:</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="do">##  ranger::ranger(temp ~ ., data = samp_rstdf) </span></span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb17-6"><a href="#cb17-6" tabindex="-1"></a><span class="do">## Type:                             Regression </span></span>
<span id="cb17-7"><a href="#cb17-7" tabindex="-1"></a><span class="do">## Number of trees:                  500 </span></span>
<span id="cb17-8"><a href="#cb17-8" tabindex="-1"></a><span class="do">## Sample size:                      30000 </span></span>
<span id="cb17-9"><a href="#cb17-9" tabindex="-1"></a><span class="do">## Number of independent variables:  29 </span></span>
<span id="cb17-10"><a href="#cb17-10" tabindex="-1"></a><span class="do">## Mtry:                             5 </span></span>
<span id="cb17-11"><a href="#cb17-11" tabindex="-1"></a><span class="do">## Target node size:                 5 </span></span>
<span id="cb17-12"><a href="#cb17-12" tabindex="-1"></a><span class="do">## Variable importance mode:         none </span></span>
<span id="cb17-13"><a href="#cb17-13" tabindex="-1"></a><span class="do">## Splitrule:                        variance </span></span>
<span id="cb17-14"><a href="#cb17-14" tabindex="-1"></a><span class="do">## OOB prediction error (MSE):       22.89146 </span></span>
<span id="cb17-15"><a href="#cb17-15" tabindex="-1"></a><span class="do">## R squared (OOB):                  0.7085754</span></span></code></pre></div>
<p>Now, let’s plot the predicted image considering the train/cropped RGB (with outliers removed: &lt; 3.5% percentile):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_term_train_outlrm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/remove_outliers.html">remove_outliers</a></span><span class="op">(</span><span class="va">rf_sup_res</span><span class="op">$</span><span class="va">pred_temp_train</span>, pmin <span class="op">=</span> <span class="fl">3.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_lr</span>, main<span class="op">=</span><span class="st">"Cropped RGB image"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">temp_out_rm</span>, palette<span class="op">=</span><span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Thermal train data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">pred_term_train_outlrm</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Synthetic/predicted thermal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-train-pred-rf-1.png"><!-- --></p>
<p>And now, using the full RGB to generate the “synthetic”/predicted thermal image (also w/ outliers removed):</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Remove outliers</span></span>
<span><span class="va">pred_term_full_outlrm</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/remove_outliers.html">remove_outliers</a></span><span class="op">(</span><span class="va">rf_sup_res</span><span class="op">$</span><span class="va">pred_temp_rgb_hr</span>, pmin <span class="op">=</span> <span class="fl">7.5</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_hr</span>, main<span class="op">=</span><span class="st">"Full RGB image"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">pred_term_full_outlrm</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Synthetic/predicted thermal"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/plot-full-rgb-pred-rf-1.png"><!-- --></p>
<p>Notice how the RF model can reasonably predict the temperature of pixels fully outside of the training sample/conditions!</p>
<hr>
</div>
<div class="section level2">
<h2 id="working-with-regions-of-interest-rois">Working with regions-of-interest ROIs<a class="anchor" aria-label="anchor" href="#working-with-regions-of-interest-rois"></a>
</h2>
<p>Basically there are two ways to currently</p>
<div class="section level3">
<h3 id="drawing-rois-with-the-terra-package">Drawing ROIs with the terra package<a class="anchor" aria-label="anchor" href="#drawing-rois-with-the-terra-package"></a>
</h3>
<p>The objective of this demo is to check the distribution of temperature values between different micro-habitats in the tree bole (the bark and one cavity). To do this we will draw a ROI geometry for each.</p>
<p>To draw an ROI we will use the <code>draw</code> function from the <code>terra</code> package. This function allows drawing on a plot to get a <code>SpatVector</code> (points, lines or polygons) or <code>SpatExtent</code> object for later use. After calling the function, start clicking on the cropped RGB image (since this one overlaps with thermal, i.e. same number of columns/rows) to draw the selected geometry. When you are done, press ESC or select “Stop”. You can also preset the maximum number of clicks.</p>
<p>Let’s start by loading the train image:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Image path in sample data</span></span>
<span><span class="va">querc_image_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"QUEROB1_EINBRGB_BWWG4662.JPG"</span>, package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">querc_rgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_rgb_to_rast.html">flir_rgb_to_rast</a></span><span class="op">(</span><span class="va">querc_image_path</span>, <span class="va">exiftool_path</span>, crop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">querc_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_raw_to_thermal.html">flir_raw_to_thermal</a></span><span class="op">(</span><span class="va">querc_image_path</span>, <span class="va">exiftool_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">querc_temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"temp_c"</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">querc_rgb</span>, main<span class="op">=</span><span class="st">"RGB cropped"</span><span class="op">)</span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">querc_temp</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Thermal - oak tree"</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/get-oak-sample-data-1.png"><!-- --></p>
<p>Start a new plotting device (useful to avoid issues with <code>draw</code> when using RStudio) and then draw the ROI. The vertices coordinates will be saved in each object.</p>
<p>Because the drawing is interactive, for the purpose of this explanation we will use a cached version of the ROIs stored in a GeoJSON file previously generated and available in the sample data for <code>ThermalRaster</code> package.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Start a new plotting device without RStudio graphics device</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.new</a></span><span class="op">(</span>noRStudioGD <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Plot the RGB image, in this case the cropped one which matches the thermal image</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">querc_rgb</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Draw polygons and attribute a type</span></span>
<span><span class="va">bole_s1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/draw.html" class="external-link">draw</a></span><span class="op">(</span><span class="st">"polygon"</span>, id <span class="op">=</span> <span class="cn">FALSE</span>, xpd <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span></span>
<span><span class="va">bole_s1</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"bark"</span></span>
<span></span>
<span><span class="va">bole_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/draw.html" class="external-link">draw</a></span><span class="op">(</span><span class="st">"polygon"</span>, id <span class="op">=</span> <span class="cn">FALSE</span>, xpd <span class="op">=</span> <span class="cn">FALSE</span>, col <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span>
<span><span class="va">bole_s2</span><span class="op">$</span><span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"cavity"</span></span>
<span></span>
<span><span class="co"># Join the polygon ROIs</span></span>
<span><span class="va">tree_samps</span> <span class="op">&lt;-</span> <span class="va">bole_s1</span> <span class="op">+</span> <span class="va">bole_s2</span></span>
<span></span>
<span><span class="co">#(Write data to later reuse)</span></span>
<span><span class="co"># writeVector(tree_samps, filename = "./inst/extdata/QUEROB1_EINBRGB_BWWG4662_ROIs_bole.json",</span></span>
<span><span class="co">#             overwrite = TRUE)</span></span></code></pre></div>
<p>Now let’s compare the distribution of temperature values for the bark and the cavity for an oak tree:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">geojson_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"QUEROB1_EINBRGB_BWWG4662_ROIs_bole.json"</span>, </span>
<span>                            package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tree_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">geojson_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">tree_samps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">querc_rgb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree_samps</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>, legend<span class="op">=</span><span class="cn">TRUE</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="va">tree_samps</span><span class="op">$</span><span class="va">type</span>, pch <span class="op">=</span> <span class="fl">20</span>, xpd<span class="op">=</span><span class="cn">NA</span>, bg<span class="op">=</span><span class="st">"white"</span>, </span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">querc_temp</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Thermal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">tree_samps</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/analyze-oak-sample-data-1.png"><!-- --></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataframe with the polygon sequential ID and its type</span></span>
<span><span class="va">tree_samps_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">tree_samps</span><span class="op">)</span>, </span>
<span>                            type <span class="op">=</span> <span class="va">tree_samps</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the values for each ROI and then </span></span>
<span><span class="co"># Join the temp values with its type using </span></span>
<span><span class="va">ext_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">querc_temp</span>, <span class="va">tree_samps</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tree_samps_df</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">ext_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">na.omit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`type`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">temp_c</span><span class="op">)</span>, std<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span>, col.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>,<span class="st">"Mean"</span>,<span class="st">"Std.-dev."</span><span class="op">)</span>,</span>
<span>               caption<span class="op">=</span><span class="st">"Average and std-deviation of temperature values (deg.C)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Type</th>
<th align="right">Mean</th>
<th align="right">Std.-dev.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bark</td>
<td align="right">21.59</td>
<td align="right">0.59</td>
</tr>
<tr class="even">
<td align="left">cavity</td>
<td align="right">20.47</td>
<td align="right">0.61</td>
</tr>
</tbody>
</table>
<p>Average and std-deviation of temperature values (deg.C)</p>
<p>Now let’s use a different image, this time for a beech tree:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">beech_image_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"BEECH1_EOUTTREERGB_ILAC9031.JPG"</span>, package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">beech_rgb</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_rgb_to_rast.html">flir_rgb_to_rast</a></span><span class="op">(</span><span class="va">beech_image_path</span>, <span class="va">exiftool_path</span>, crop<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">beech_temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/flir_raw_to_thermal.html">flir_raw_to_thermal</a></span><span class="op">(</span><span class="va">beech_image_path</span>, <span class="va">exiftool_path</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beech_temp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"temp_c"</span></span>
<span></span>
<span><span class="va">beech_geojson_file</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"BEECH1_EOUTTREERGB_ILAC9031_ROIs_bole.json"</span>, </span>
<span>                            package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span><span class="va">beech_tree_samps</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">beech_geojson_file</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">beech_tree_samps</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">beech_rgb</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">beech_tree_samps</span>, col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span>, legend<span class="op">=</span><span class="cn">TRUE</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="va">beech_tree_samps</span><span class="op">$</span><span class="va">type</span>, pch <span class="op">=</span> <span class="fl">20</span>, xpd<span class="op">=</span><span class="cn">NA</span>, bg<span class="op">=</span><span class="st">"white"</span>, </span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"red"</span>,<span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="reference/plot_temp_rast.html">plot_temp_rast</a></span><span class="op">(</span><span class="va">beech_temp</span>, palette <span class="op">=</span> <span class="st">"magma"</span>, main<span class="op">=</span><span class="st">"Thermal"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">beech_tree_samps</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/analyze-beech-data-1.png"><!-- --></p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Create a dataframe with the polygon sequential ID and its type</span></span>
<span><span class="va">tree_samps_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beech_tree_samps</span><span class="op">)</span>, </span>
<span>                            type <span class="op">=</span> <span class="va">beech_tree_samps</span><span class="op">$</span><span class="va">type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Extract the values for each ROI and then </span></span>
<span><span class="co"># Join the temp values with its type using </span></span>
<span><span class="va">beech_ext_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">beech_temp</span>, <span class="va">beech_tree_samps</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">tree_samps_df</span>, by<span class="op">=</span><span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Summarise values</span></span>
<span><span class="va">beech_ext_values</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="va">na.omit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">`type`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>mean <span class="op">=</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/summarize-generics.html" class="external-link">median</a></span><span class="op">(</span><span class="va">temp_c</span><span class="op">)</span>, std<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">temp_c</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>digits<span class="op">=</span><span class="fl">2</span>, col.names<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Type"</span>,<span class="st">"Mean"</span>,<span class="st">"Std.-dev."</span><span class="op">)</span>,</span>
<span>               caption<span class="op">=</span><span class="st">"Average and std-deviation of temperature values (deg.C)"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">Type</th>
<th align="right">Mean</th>
<th align="right">Std.-dev.</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">bark</td>
<td align="right">19.30</td>
<td align="right">4.25</td>
</tr>
<tr class="even">
<td align="left">cavity</td>
<td align="right">13.96</td>
<td align="right">3.10</td>
</tr>
</tbody>
</table>
<p>Average and std-deviation of temperature values (deg.C)</p>
<p>Now, let’s make a plot comparing the distributions of the two micro-habitats - check for potential multimodality and differences on the medians:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">ext_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">temp_c</span>, fill<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Temperature "</span> <span class="op">(</span> <span class="va">degree</span><span class="op">*</span><span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Oak"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g1</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-1-1.png"><!-- --></p>
<p>The same plot but this time for the beech:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">g2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">beech_ext_values</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">temp_c</span>, fill<span class="op">=</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha<span class="op">=</span><span class="fl">0.5</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Beech"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span><span class="st">"Temperature "</span> <span class="op">(</span> <span class="va">degree</span><span class="op">*</span><span class="va">C</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"Density"</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>text<span class="op">=</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_text</a></span><span class="op">(</span>size<span class="op">=</span><span class="fl">16</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">g2</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-2-1.png"><!-- --></p>
<hr>
</div>
<div class="section level3">
<h3 id="drawing-rois-with-the-roboflow">Drawing ROIs with the Roboflow<a class="anchor" aria-label="anchor" href="#drawing-rois-with-the-roboflow"></a>
</h3>
<p>Roboflow is a development platform that simplifies the process of building and deploying computer vision models. It offers a range of tools designed to assist developers in preparing, creating, and managing datasets needed for training machine learning models, with a particular emphasis on image recognition tasks.</p>
<p>In this context we will use Roboflow’s features to generate ROI’s of micro-habitats to showcase its main functions. A <a href="vignettes/Protocol_for_annotating_thermal_images_using_Roboflow_app.pdf">tutorial/vignette</a> on this issue is provided here with much more details on how to collect ROI’s using Roboflow.</p>
<figure><img src="reference/figures/Roboflow_app_01.png" alt="Examples of Roboflow annotations on tree micro-habitats. Notice the detailed contours that this tool is capable of capturing."><figcaption aria-hidden="true">
Examples of Roboflow annotations on tree micro-habitats. Notice the detailed contours that this tool is capable of capturing.
</figcaption></figure><p>In a nutshell, there are two main ways of making ROI’s in Roboflow:</p>
<ul>
<li>
<p>“<strong>Smart Polygon</strong>” – This is a semi-automatic tool based on SAM (Facebook’s Segment Anything Model) which can retrieve object boundaries easily, sometimes with a single click. Use one click to add one point inside the area you want to be on the polygon mask. If new points are added within the initial area, that area will be removed. Conversely, if a point is placed outside the existing area, the algorithm will try to expand the object the best way possible by context, spectral and textural similarity.</p>
<p><img src="reference/figures/RoboFlow_SmartPolygon_tool.png"></p>
</li>
<li>
<p>Another available option is the fully manual “<strong>Polygon Tool</strong>”, which gives complete control to the user for drawing a polygon to delineate the mask.</p>
<p><img src="reference/figures/RoboFlow_Polygon_tool.png"></p>
</li>
</ul>
<p>ℹ️ <u><strong>Note</strong></u>: polygons cannot have “holes” or “islands”. This set of tools for annotation in Roboflow app cannot handle such representations.</p>
<p>Roboflow annotations are recorded into a specific JSON format. <code>ThermalRaster</code> can use these data stored as JSON files and convert them into <code>sf</code> objects compatible with raster data from the <code>terra</code> package.</p>
<figure><img src="reference/figures/Roboflow_interface.png" alt="Roboflow interface with the annotations/ROI’s in JSON format in the bottom left corner. In this case an oak tree canopy is displayed in the sample."><figcaption aria-hidden="true">
Roboflow interface with the annotations/ROI’s in JSON format in the bottom left corner. In this case an oak tree canopy is displayed in the sample.
</figcaption></figure><div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Roboflow sample data</span></span>
<span><span class="va">robo_rois_path</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"EINBRGB_IPUQ4327.json"</span>, </span>
<span>                          package <span class="op">=</span> <span class="st">"ThermalRaster"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># JSON data loaded from a Roboflow json file</span></span>
<span><span class="va">json</span> <span class="op">&lt;-</span> <span class="fu">jsonlite</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/jsonlite/man/fromJSON.html" class="external-link">fromJSON</a></span><span class="op">(</span><span class="va">robo_rois_path</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">json</span><span class="op">$</span><span class="va">boxes</span><span class="op">[</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb29"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a><span class="do">##      type  label        x        y     width    height</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="do">## 1 polygon cavity 646.8750 831.7969  455.6250 1213.5938</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a><span class="do">## 2 polygon   bole 532.9688 720.0000 1054.6875 1440.0000</span></span></code></pre></div>
<p>To convert Roboflow annotations into <code>sf</code> polygons actually usable with <code>ThermalRaster</code> is simple. In this example, the ROIs were collected in Roboflow from FLIR’s thumbnail image — which has a size of 1440 x 1080 pixels — however, we want to convert those annotations into the dimensions of the thermal image (which is 640 x 480) hence with a scale factor of 2.25 (i.e., f = 1440 / 640). In the first step (<code>get_roboflow_masks)</code> we generate all the masks from the JSON file and, in the second <code>simplify_roboflow_masks</code>, we aggregate/simplify the masks by label/category.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">robo_masks</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/get_roboflow_masks.html">get_roboflow_masks</a></span><span class="op">(</span>path <span class="op">=</span> <span class="va">robo_rois_path</span>, </span>
<span>                                 rst_height <span class="op">=</span> <span class="fl">640</span>, </span>
<span>                                 rst_width <span class="op">=</span> <span class="fl">480</span>,</span>
<span>                                 geom_rescale <span class="op">=</span> <span class="fl">2.25</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">robo_masks_simple</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/simplify_roboflow_masks.html">simplify_roboflow_masks</a></span><span class="op">(</span><span class="va">robo_masks</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">robo_masks_simple</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a><span class="do">## $labs</span></span>
<span id="cb31-2"><a href="#cb31-2" tabindex="-1"></a><span class="do">## [1] "cavity" "bole"  </span></span>
<span id="cb31-3"><a href="#cb31-3" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-4"><a href="#cb31-4" tabindex="-1"></a><span class="do">## $pol_masks</span></span>
<span id="cb31-5"><a href="#cb31-5" tabindex="-1"></a><span class="do">## $pol_masks[[1]]</span></span>
<span id="cb31-6"><a href="#cb31-6" tabindex="-1"></a><span class="do">##  class       : SpatVector </span></span>
<span id="cb31-7"><a href="#cb31-7" tabindex="-1"></a><span class="do">##  geometry    : polygons </span></span>
<span id="cb31-8"><a href="#cb31-8" tabindex="-1"></a><span class="do">##  dimensions  : 1, 1  (geometries, attributes)</span></span>
<span id="cb31-9"><a href="#cb31-9" tabindex="-1"></a><span class="do">##  extent      : 187, 389, 1, 540  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb31-10"><a href="#cb31-10" tabindex="-1"></a><span class="do">##  coord. ref. :  </span></span>
<span id="cb31-11"><a href="#cb31-11" tabindex="-1"></a><span class="do">##  names       : layer</span></span>
<span id="cb31-12"><a href="#cb31-12" tabindex="-1"></a><span class="do">##  type        : &lt;int&gt;</span></span>
<span id="cb31-13"><a href="#cb31-13" tabindex="-1"></a><span class="do">##  values      :     1</span></span>
<span id="cb31-14"><a href="#cb31-14" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-15"><a href="#cb31-15" tabindex="-1"></a><span class="do">## $pol_masks[[2]]</span></span>
<span id="cb31-16"><a href="#cb31-16" tabindex="-1"></a><span class="do">##  class       : SpatVector </span></span>
<span id="cb31-17"><a href="#cb31-17" tabindex="-1"></a><span class="do">##  geometry    : polygons </span></span>
<span id="cb31-18"><a href="#cb31-18" tabindex="-1"></a><span class="do">##  dimensions  : 1, 1  (geometries, attributes)</span></span>
<span id="cb31-19"><a href="#cb31-19" tabindex="-1"></a><span class="do">##  extent      : 3, 471, 0, 640  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb31-20"><a href="#cb31-20" tabindex="-1"></a><span class="do">##  coord. ref. :  </span></span>
<span id="cb31-21"><a href="#cb31-21" tabindex="-1"></a><span class="do">##  names       : layer</span></span>
<span id="cb31-22"><a href="#cb31-22" tabindex="-1"></a><span class="do">##  type        : &lt;int&gt;</span></span>
<span id="cb31-23"><a href="#cb31-23" tabindex="-1"></a><span class="do">##  values      :     1</span></span>
<span id="cb31-24"><a href="#cb31-24" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-25"><a href="#cb31-25" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-26"><a href="#cb31-26" tabindex="-1"></a><span class="do">## $rst_masks</span></span>
<span id="cb31-27"><a href="#cb31-27" tabindex="-1"></a><span class="do">## $rst_masks[[1]]</span></span>
<span id="cb31-28"><a href="#cb31-28" tabindex="-1"></a><span class="do">## class       : SpatRaster </span></span>
<span id="cb31-29"><a href="#cb31-29" tabindex="-1"></a><span class="do">## dimensions  : 640, 480, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb31-30"><a href="#cb31-30" tabindex="-1"></a><span class="do">## resolution  : 1, 1  (x, y)</span></span>
<span id="cb31-31"><a href="#cb31-31" tabindex="-1"></a><span class="do">## extent      : 0, 480, 0, 640  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb31-32"><a href="#cb31-32" tabindex="-1"></a><span class="do">## coord. ref. :  </span></span>
<span id="cb31-33"><a href="#cb31-33" tabindex="-1"></a><span class="do">## source(s)   : memory</span></span>
<span id="cb31-34"><a href="#cb31-34" tabindex="-1"></a><span class="do">## name        : layer </span></span>
<span id="cb31-35"><a href="#cb31-35" tabindex="-1"></a><span class="do">## min value   :     1 </span></span>
<span id="cb31-36"><a href="#cb31-36" tabindex="-1"></a><span class="do">## max value   :     1 </span></span>
<span id="cb31-37"><a href="#cb31-37" tabindex="-1"></a><span class="do">## </span></span>
<span id="cb31-38"><a href="#cb31-38" tabindex="-1"></a><span class="do">## $rst_masks[[2]]</span></span>
<span id="cb31-39"><a href="#cb31-39" tabindex="-1"></a><span class="do">## class       : SpatRaster </span></span>
<span id="cb31-40"><a href="#cb31-40" tabindex="-1"></a><span class="do">## dimensions  : 640, 480, 1  (nrow, ncol, nlyr)</span></span>
<span id="cb31-41"><a href="#cb31-41" tabindex="-1"></a><span class="do">## resolution  : 1, 1  (x, y)</span></span>
<span id="cb31-42"><a href="#cb31-42" tabindex="-1"></a><span class="do">## extent      : 0, 480, 0, 640  (xmin, xmax, ymin, ymax)</span></span>
<span id="cb31-43"><a href="#cb31-43" tabindex="-1"></a><span class="do">## coord. ref. :  </span></span>
<span id="cb31-44"><a href="#cb31-44" tabindex="-1"></a><span class="do">## source(s)   : memory</span></span>
<span id="cb31-45"><a href="#cb31-45" tabindex="-1"></a><span class="do">## name        : layer </span></span>
<span id="cb31-46"><a href="#cb31-46" tabindex="-1"></a><span class="do">## min value   :     1 </span></span>
<span id="cb31-47"><a href="#cb31-47" tabindex="-1"></a><span class="do">## max value   :     1</span></span></code></pre></div>
<p>ℹ️ <u><strong>Note</strong></u>: Re-scaling annotations is not needed if the size of the RGB and thermal images is exactly the same (which happens for “cropped” images as shown in the examples before).</p>
<p>The output of is a list containing three elements:</p>
<ul>
<li><p><code>labs</code> with the labels of the ROI polygons,</p></li>
<li><p><code>pol_masks</code> with the ROIs as <code>SpatVector</code> polygon objects, and</p></li>
<li><p><code>rst_masks</code> with the ROIs as <code>SpatRaster</code>.</p></li>
</ul>
<p>After applying the simplyfying step we get a list similar in structure to the input but with all masks of the same label aggregated together. Each label will correspond to a single polygon mask and a single raster mask for each category, with the latter indicating presence (1 or TRUE) or absence (<code>NA</code>) of the label at each pixel.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plotRGB.html" class="external-link">plotRGB</a></span><span class="op">(</span><span class="va">rgb_lr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">robo_masks_simple</span><span class="op">$</span><span class="va">rst_masks</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>, col<span class="op">=</span><span class="st">"blue"</span>, alpha<span class="op">=</span><span class="fl">0.3</span>, </span>
<span>     add<span class="op">=</span><span class="cn">TRUE</span>, legend<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topright"</span>, legend <span class="op">=</span> <span class="st">"cavity"</span>, pch <span class="op">=</span> <span class="fl">20</span>, xpd<span class="op">=</span><span class="cn">NA</span>, bg<span class="op">=</span><span class="st">"white"</span>, </span>
<span>       col<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="README_files/figure-gfm/unnamed-chunk-5-1.png"><!-- --></p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing ThermalRaster</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Joao Goncalves <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-6615-0218" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>



  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Joao Goncalves.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
